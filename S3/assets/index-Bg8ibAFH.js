(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();var C=Object.create,I=Object.defineProperty,R=Object.getOwnPropertyDescriptor,L=Object.getOwnPropertyNames,U=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty,k=(e,n)=>function(){return n||(0,e[L(e)[0]])((n={exports:{}}).exports,n),n.exports},M=(e,n,t,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of L(n))!V.call(e,o)&&o!==t&&I(e,o,{get:()=>n[o],enumerable:!(i=R(n,o))||i.enumerable});return e},q=(e,n,t)=>(t=e!=null?C(U(e)):{},M(!e||!e.__esModule?I(t,"default",{value:e,enumerable:!0}):t,e)),F=k({"../definitions/dist/index.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Button=e.NotLoggedIn=e.VALID_PROVIDER_HINT=e.VALID_RESPONSE_MODE=e.VALID_RESPONSE_TYPE=e.VALID_SCOPES=e.VALID_IDENTITY_CLAIMS=e.ORG_CLAIM=e.VALID_IDENTITY_ACCOUNT_CLAIMS=e.VALID_IDENTITY_STRING_CLAIMS=e.DEFAULT_PATH=e.DEFAULT_RESPONSE_MODE=e.DEFAULT_RESPONSE_TYPE=e.DEFAULT_SCOPE=e.PRODUCTION_WALLET=void 0,e.PRODUCTION_WALLET="https://wallet.hello.coop",e.DEFAULT_SCOPE=["openid","name","email","picture"],e.DEFAULT_RESPONSE_TYPE="code",e.DEFAULT_RESPONSE_MODE="query",e.DEFAULT_PATH="/authorize?",e.VALID_IDENTITY_STRING_CLAIMS=["name","nickname","preferred_username","given_name","family_name","email","phone","picture","ethereum"],e.VALID_IDENTITY_ACCOUNT_CLAIMS=["discord","twitter","github","gitlab"],e.ORG_CLAIM="org",e.VALID_IDENTITY_CLAIMS=[...e.VALID_IDENTITY_STRING_CLAIMS,...e.VALID_IDENTITY_ACCOUNT_CLAIMS,"org","email_verified","phone_verified"],e.VALID_SCOPES=[...e.VALID_IDENTITY_STRING_CLAIMS,...e.VALID_IDENTITY_ACCOUNT_CLAIMS,"profile","openid","profile_update"],e.VALID_RESPONSE_TYPE=["id_token","code"],e.VALID_RESPONSE_MODE=["fragment","query","form_post"],e.VALID_PROVIDER_HINT=["apple","discord","facebook","github","gitlab","google","twitch","twitter","tumblr","mastodon","microsoft","line","wordpress","yahoo","phone","ethereum","qrcode","apple--","microsoft--"],e.NotLoggedIn={isLoggedIn:!1};var n;(function(t){t.STYLES_URL="https://cdn.hello.coop/css/hello-btn.css",t.HOVER_MAPPING={pop:"",glow:"hello-btn-hover-glow",flare:"hello-btn-hover-flare",none:"hello-btn-hover-none"},t.CLASS_MAPPING={black:{"ignore-light":"","ignore-dark":"hello-btn-black-on-dark","aware-invert":"hello-btn-black-and-invert","aware-static":"hello-btn-black-and-static"},white:{"ignore-light":"hello-btn-white-on-light","ignore-dark":"hello-btn-white-on-dark","aware-invert":"hello-btn-white-and-invert","aware-static":"hello-btn-white-and-static"}}})(n||(e.Button=n={}))}});function Y(e){return crypto.getRandomValues(new Uint8Array(e))}function j(e){const n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let t="";const i=Y(e);for(let o=0;o<e;o++){const r=i[o]%n.length;t+=n[r]}return t}function G(e){return j(e)}async function H(e){const n=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(n))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function J(e){if(e||(e=43),e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;const n=G(e),t=await H(n);return{code_verifier:n,code_challenge:t}}var a=q(F());function B(e){return a.VALID_SCOPES.includes(e)}function W(e){return e.every(n=>B(n))}async function O(e){if(!e.client_id)throw new Error("client_id is required in the authorization request.");if(!e.redirect_uri)throw new Error("redirect_uri is required in the authorization request.");if(e.scope){if(!W(e.scope))throw new Error("One or more passed scopes are invalid.");e.scope=Array.from(new Set([...e.scope,"openid"]))}if(e.response_type&&!a.VALID_RESPONSE_TYPE.includes(e.response_type))throw new Error("Invalid response_type.");if(e.response_mode&&!a.VALID_RESPONSE_MODE.includes(e.response_mode))throw new Error("Invalid response_mode.");const n=e.nonce||crypto.randomUUID();let t="";const o=(e.scope||a.DEFAULT_SCOPE).join(" "),r={client_id:e.client_id,redirect_uri:e.redirect_uri,scope:o,response_type:e.response_type||a.DEFAULT_RESPONSE_TYPE,response_mode:e.response_mode||a.DEFAULT_RESPONSE_MODE,nonce:n};if(e.prompt&&(r.prompt=e.prompt),r.response_type==="code"){const d=await J();t=d.code_verifier,r.code_challenge=d.code_challenge,r.code_challenge_method="S256"}return e.provider_hint&&(r.provider_hint=e.provider_hint.join(" ")),e.login_hint&&(r.login_hint=e.login_hint),e.domain_hint&&(r.domain_hint=e.domain_hint),{url:(e.wallet||a.PRODUCTION_WALLET)+a.DEFAULT_PATH+new URLSearchParams(r).toString(),nonce:n,code_verifier:t}}var $="/oauth/token";async function z({code:e,code_verifier:n,client_id:t,redirect_uri:i,wallet:o}){const r={code:e,code_verifier:n,client_id:t,redirect_uri:i,grant_type:"authorization_code"},c=new URLSearchParams(r).toString(),d=(o||a.PRODUCTION_WALLET)+$;try{const u=await fetch(d,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c}),s=await u.json();if(!u.ok){const N=`Fetch ${d} failed with ${u.status}. `+(s.error?s.error+".":"");throw new Error(N)}if(s.error)throw new Error(s.error);if(!s.id_token)throw new Error("No id_token in response.");return s.id_token}catch(u){throw new Error(u)}}function S(e){var n=e.replace(/-/g,"+").replace(/_/g,"/"),t=decodeURIComponent(window.atob(n).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(t)}function K(e){try{const[n,t]=e.split("."),i=S(n),o=S(t);return{header:i,payload:o}}catch(n){throw new Error(n)}}a.DEFAULT_PATH;a.DEFAULT_RESPONSE_MODE;a.DEFAULT_RESPONSE_TYPE;a.DEFAULT_SCOPE;a.PRODUCTION_WALLET;a.VALID_RESPONSE_MODE;a.VALID_RESPONSE_TYPE;a.VALID_SCOPES;const l={client_id:"app_GreenfieldFitnessDemoApp_s9z",redirect_uri:"http://localhost:5173",scope:["openid","profile","nickname"],response_mode:"fragment",domain_hint:"personal"},f=document.querySelector("#login-btn"),Q=document.querySelector("#logout-btn"),h=document.querySelector("#update-btn"),w=document.querySelector("#invite-btn"),T=document.querySelector("#profile-page"),m=document.querySelector("#login-page"),P=document.querySelector("#profile-page-content"),A=document.querySelector("#modal-container"),X=document.querySelector("#error-container"),g=document.querySelector("#error"),Z=document.querySelector("#full-name"),x=document.querySelector("#preferred-name"),ee=document.querySelector("#email"),y=document.querySelector("#picture"),ne=document.querySelector("#load-spinner"),te=document.querySelector("#close-modal-btn");window.addEventListener("load",oe);f.addEventListener("click",D);Q.addEventListener("click",ie);h.addEventListener("click",re);w.addEventListener("click",le);te.addEventListener("click",ce);async function oe(){const{search:e}=window.location,n=window.location.hash.substring(1),t=new URLSearchParams(e||n),i=t.has("iss"),o=t.has("code"),r=t.has("error"),c=JSON.parse(sessionStorage.getItem("profile"));if(i)return D(null,t);o?ae(t):r?v(t,c):c?E(c):p(),b(),se()}async function D(e,n){f.classList.add("hello-btn-loader"),f.disabled=!0;const{url:t,nonce:i,code_verifier:o}=await O({...l,login_hint:(n==null?void 0:n.get("login_hint"))||void 0,domain_hint:(n==null?void 0:n.get("domain_hint"))||l.domain_hint});sessionStorage.setItem("nonce",i),sessionStorage.setItem("code_verifier",o),await _({u:"/start/login",n:"action"}),window.location.href=t}async function re(){h.classList.add("hello-btn-loader"),h.disabled=!0;const{url:e,nonce:n,code_verifier:t}=await O({...l,prompt:"consent"});sessionStorage.setItem("nonce",n),sessionStorage.setItem("code_verifier",t),await _({u:"/update",n:"action"}),window.location.href=e}function ie(){_({u:"/logout",n:"action"}),sessionStorage.clear(),p()}async function ae(e){try{const n=await z({client_id:l.client_id,redirect_uri:l.redirect_uri,code_verifier:sessionStorage.getItem("code_verifier"),nonce:sessionStorage.getItem("nonce"),code:e.get("code")}),{payload:t}=K(n);sessionStorage.clear(),sessionStorage.setItem("profile",JSON.stringify(t)),_({u:"/profile"}),E(t)}catch(n){console.error(n),sessionStorage.clear(),p(),v(e)}finally{b()}}function v(e,n){const t=e.get("error");A.style.display="flex",X.style.display="block",t==="access_denied"?g.innerText="User cancelled request.":g.innerText="Something went wrong.",n?E(n):p()}function ce(){A.style.display="none"}function b(){window.location.hash&&(window.location.replace("#"),typeof window.history.replaceState=="function"&&history.replaceState({},"",window.location.href.slice(0,-1)))}function se(){ne.style.display="none"}function p(){let e="/";window.location.search&&(e+=window.location.search),_({u:e}),m.style.visibility="visible",m.style.position="relative",T.style.display="none",P.style.display="none",document.body.style.backgroundImage="url(/assets/bg.jpg)"}async function _(e){if(localStorage.getItem("plausible_ignore")=="true"||window.location.origin!=="https://www.greenfielddemo.com"){console.info("Ignoring Event: localStorage flag");return}const n={w:window.innerWidth,d:"greenfielddemo.com",...e,n:e.n||"pageview",r:e.r||document.referrer||null,u:new URL(e.u,"https://www.greenfielddemo.com")};try{await fetch("/api/event",{method:"POST",body:JSON.stringify(n)}),console.info(`Event sent: ${n.u} (${n.n})`)}catch(t){console.error(t)}}function E(e){const{name:n,nickname:t,picture:i,email:o}=e;Z.innerText=n,x.innerText=t,ee.innerText=o,y.src=i,y.style.backgroundImage=`url('${i}')`,T.style.display=P.style.display="block"}async function le(){w.classList.add("hello-btn-loader"),w.disabled=!0;const{sub:e}=JSON.parse(sessionStorage.getItem("profile")),n=new URL("https://wallet.hello.coop/invite");n.searchParams.append("inviter",e),n.searchParams.append("client_id",l.client_id),n.searchParams.append("initiate_login_uri",window.location.origin),n.searchParams.append("return_uri",window.location.origin),window.location.href=n.href}(function(){window.onpageshow=function(e){e.persisted&&window.location.reload()}})();
